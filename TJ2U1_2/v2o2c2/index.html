<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>house spelling game</title>

  <style>
    :root{
      --shadow: 0 14px 40px rgba(0,0,0,.12);
      --accent:#3c6cff;
      --text:#0e1630;
      --muted:#52607a;

      /* ‚úÖ ÊúÉË¢´ JS ‰æùÂñÆÂ≠óÈï∑Â∫¶Ëá™ÂãïË™øÊï¥ÔºåÁ¢∫‰øù window Ê∞∏ÈÅ†Âêå‰∏ÄÊéí */
      --slotSize: 64px;
      --slotFont: 34px;
      --slotGap: 10px;
    }

    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 18px 18px, rgba(255,182,193,.35) 12px, transparent 13px),
        radial-gradient(circle at 48px 52px, rgba(173,216,230,.35) 10px, transparent 11px),
        radial-gradient(circle at 82px 26px, rgba(255,235,164,.40) 10px, transparent 11px),
        linear-gradient(180deg, #f7f8ff, #f4fbff);
      background-size: 110px 90px, 120px 100px, 130px 110px, auto;
      background-attachment: fixed;
    }

    .wrap{max-width:980px;margin:0 auto;padding:18px 16px 28px;}
    .top{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:12px;}

    h1{
      margin:0;
      font-size:40px;
      letter-spacing:.4px;
      display:flex;
      align-items:center;
      gap:10px;
      text-transform: lowercase;
    }
    h1 .tag{
      font-size:16px;
      font-weight:1000;
      color:#fff;
      background:rgba(60,108,255,.85);
      padding:6px 10px;
      border-radius:999px;
      box-shadow:0 10px 22px rgba(60,108,255,.22);
    }

    .hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end;}
    .pill{
      background: rgba(255,255,255,.85);
      border: 2px solid rgba(215,221,255,.9);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 1000;
      font-size: 18px;
      box-shadow: 0 10px 25px rgba(0,0,0,.06);
      backdrop-filter: blur(6px);
      text-transform: lowercase;
    }

    .btn{
      border:none;
      background:var(--accent);
      color:#fff;
      font-weight:1000;
      font-size:20px;
      padding:12px 16px;
      border-radius:16px;
      cursor:pointer;
      box-shadow:var(--shadow);
      text-transform: lowercase;
    }
    .btn.secondary{
      background: rgba(255,255,255,.9);
      color: var(--text);
      border: 2px solid rgba(215,221,255,.95);
      box-shadow:none;
    }
    .btn:active{transform: translateY(1px);}

    .panel{
      background: rgba(255,255,255,.88);
      border-radius: 22px;
      box-shadow: var(--shadow);
      border: 2px solid rgba(0,0,0,.04);
      padding: 18px;
      backdrop-filter: blur(8px);
    }

    .row{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;align-items:stretch;}
    @media (max-width:860px){
      .row{grid-template-columns:1fr;}
      h1{font-size:34px;}
    }

    .imgBox{
      border: 3px dashed rgba(60,108,255,.35);
      border-radius: 22px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      background: rgba(255,255,255,.60);
      min-height:320px;
      position:relative;
      overflow:hidden;
    }
    .imgBox::before{
      content:"";
      position:absolute;
      inset:-30px;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,182,193,.35), transparent 55%),
        radial-gradient(circle at 80% 35%, rgba(173,216,230,.35), transparent 55%),
        radial-gradient(circle at 40% 85%, rgba(255,235,164,.40), transparent 55%);
      filter: blur(10px);
      z-index:0;
    }
    .imgBox img{
      position:relative;
      z-index:1;
      width: min(420px, 100%);
      max-height: 360px;
      object-fit: contain;
      display:block;
      filter: drop-shadow(0 18px 22px rgba(0,0,0,.12));
    }

    .right{display:flex;flex-direction:column;gap:14px;}
    .title2{font-size:24px;font-weight:1000;margin:0;text-transform: lowercase;}
    .hint{margin:0;font-size:18px;color:var(--muted);line-height:1.35;font-weight:900;}

    .slotsWrap{
      border-radius: 18px;
      border: 2px solid rgba(215,221,255,.95);
      background: rgba(255,255,255,.72);
      padding: 12px;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    /* ‚úÖ Ê∞∏ÈÅ†Âêå‰∏ÄÊéíÔºå‰∏çÊèõË°å */
    .slots{
      display:flex;
      flex-wrap: nowrap;
      justify-content:center;
      align-items:center;
      gap: var(--slotGap);
      min-height: 86px;
      transform-origin: center;
      width: 100%;
    }

    .slot{
      width: var(--slotSize);
      height: calc(var(--slotSize) + 8px);
      border-radius: 18px;
      border:3px dashed rgba(60,108,255,.35);
      background: rgba(60,108,255,.07);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: var(--slotFont);
      font-weight:1000;
      user-select:none;
      text-transform: lowercase;
      flex: 0 0 auto;
      transition: transform .12s ease;
    }
    .slot.filled{
      border-style: solid;
      border-color: rgba(31,191,117,.45);
      background: rgba(31,191,117,.12);
    }

    .tiles{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-start;
      padding:12px;
      border-radius:18px;
      border:2px solid rgba(215,221,255,.95);
      background: rgba(255,255,255,.88);
      min-height:90px;
      align-items:center;
    }

    .tile{
      width:68px;
      height:74px;
      border-radius:20px;
      background:#ffe27a;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:34px;
      font-weight:1000;
      cursor:grab;
      user-select:none;
      box-shadow:0 10px 22px rgba(0,0,0,.10);
      border:2px solid rgba(0,0,0,.06);
      text-transform: lowercase;
      transition: transform .12s ease, opacity .12s ease;
    }
    .tile:active{cursor:grabbing;}

    .status{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      padding:10px 12px;
      border-radius:16px;
      border:2px solid rgba(215,221,255,.95);
      background: rgba(255,255,255,.78);
      min-height:56px;
      font-size:20px;
      font-weight:1000;
      text-transform: lowercase;
    }
    .status .small{
      font-size:16px;
      font-weight:900;
      color:var(--muted);
      text-transform:none;
    }
    .badge{
      padding:8px 12px;
      border-radius:999px;
      font-weight:1000;
      font-size:18px;
      border:2px solid rgba(215,221,255,.95);
      background: rgba(255,255,255,.9);
      text-transform: lowercase;
    }
    .badge.ok{
      border-color: rgba(31,191,117,.5);
      background: rgba(31,191,117,.12);
      color:#0b6d41;
    }
    .badge.bad{
      border-color: rgba(255,91,107,.55);
      background: rgba(255,91,107,.12);
      color:#8c0f1d;
    }

    .bottomBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top: 12px;
    }

    @keyframes pop {
      0%{transform: scale(1);}
      45%{transform: scale(1.08);}
      100%{transform: scale(1);}
    }
    @keyframes shake {
      0%{transform: translateX(0);}
      20%{transform: translateX(-8px);}
      40%{transform: translateX(8px);}
      60%{transform: translateX(-6px);}
      80%{transform: translateX(6px);}
      100%{transform: translateX(0);}
    }
    .pop{animation: pop .22s ease-out;}
    .shake{animation: shake .28s ease-out;}

    /* finish overlay */
    .overlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 999;
      background: rgba(15, 22, 48, .35);
      backdrop-filter: blur(6px);
    }
    .overlay.show{display:flex;}
    .modal{
      width: min(720px, 100%);
      background: rgba(255,255,255,.92);
      border: 2px solid rgba(215,221,255,.95);
      border-radius: 26px;
      box-shadow: 0 30px 80px rgba(0,0,0,.25);
      padding: 20px;
      position: relative;
      overflow:hidden;
    }
    .modal h2{
      margin: 0 0 8px;
      font-size: 34px;
      font-weight: 1100;
      letter-spacing:.4px;
      text-transform: lowercase;
    }
    .modal p{
      margin: 6px 0 14px;
      font-size: 20px;
      font-weight: 900;
      color: var(--muted);
    }
    .bigReplay{
      width:100%;
      padding: 16px 18px;
      font-size: 26px;
      border-radius: 18px;
      font-weight: 1100;
      background: linear-gradient(90deg, #3c6cff, #7b61ff);
      color:#fff;
      border:none;
      cursor:pointer;
      box-shadow: 0 18px 40px rgba(60,108,255,.30);
      text-transform:none;
    }
    .bigReplay:active{transform: translateY(1px);}

    canvas#fx{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      opacity:.95;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <h1>üè† house spelling <span class="tag">auto</span></h1>

      <div class="hud">
        <div class="pill">‚è± time: <span id="time">0.0</span>s</div>
        <div class="pill">‚úÖ <span id="score">0</span>/3</div>
        <button class="btn secondary" id="speakBtn">üîä say word</button>
        <button class="btn" id="restartBtn">üîÅ play again</button>
      </div>
    </div>

    <div class="panel">
      <div class="row">
        <div class="imgBox">
          <img id="pic" src="" alt="picture"/>
        </div>

        <div class="right">
          <div>
            <p class="title2">drag the letters to spell:</p>
            <p class="hint">‚úÖ spell in one line ÔΩú wrong letters go back</p>
          </div>

          <div class="slotsWrap">
            <div class="slots" id="slots"></div>
          </div>

          <div class="tiles" id="tiles"></div>

          <div class="status" id="status">
            <span>ready!</span>
            <span class="small">Ôºàdrag letters to slotsÔºâ</span>
          </div>

          <div class="bottomBtns">
            <button class="btn secondary" id="clearBtn">üßΩ clear</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="modal">
      <canvas id="fx"></canvas>
      <h2>üéâ you did it!</h2>
      <p id="finalText">nice!</p>
      <button class="bigReplay" id="bigReplay">üîÅ ÂÜç‰æÜ‰∏ÄÊ¨° play again</button>
    </div>
  </div>

<script>
  // ‚úÖ ÂúñÁâáÊ™îÂêç‰∏çÂêåÂ∞±ÊîπÈÄô 3 Ë°å
  const items = [
    { word: "house",  img: "images/house.png"  },
    { word: "window", img: "images/window.png" },
    { word: "door",   img: "images/door.png"   },
  ];

  const $ = (id) => document.getElementById(id);

  // ‚úÖ Âî∏ÂñÆÂ≠ó
  function speak(text){
    try{
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US";
      u.rate = 0.95;
      speechSynthesis.speak(u);
    }catch(e){}
  }

  // ‚úÖ Âî∏Â≠óÊØçÔºàÊãñÊõ≥ÊôÇ„ÄÅÊîæÂ∞çÊôÇÔºâ
  function speakLetter(ch){
    const letter = String(ch).trim().toUpperCase();
    if(!/^[A-Z]$/.test(letter)) return;
    try{
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(letter);
      u.lang = "en-US";
      u.rate = 0.9;
      speechSynthesis.speak(u);
    }catch(e){}
  }

  function shuffle(arr){
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // state
  let order = [];
  let idx = 0;
  let score = 0;
  let startMs = 0;
  let timerHandle = null;

  const pic = $("pic");
  const slotsEl = $("slots");
  const tilesEl = $("tiles");
  const statusEl = $("status");
  const timeEl = $("time");
  const scoreEl = $("score");
  const overlay = $("overlay");
  const finalText = $("finalText");

  function startTimer(){
    startMs = performance.now();
    timerHandle = setInterval(()=>{
      const t = (performance.now() - startMs)/1000;
      timeEl.textContent = t.toFixed(1);
    }, 100);
  }
  function stopTimer(){
    if(timerHandle){
      clearInterval(timerHandle);
      timerHandle = null;
    }
  }

  function setStatus(main, sub, type=null){
    statusEl.innerHTML = "";
    const a = document.createElement("span");
    a.textContent = main;
    statusEl.appendChild(a);

    if(type){
      const b = document.createElement("span");
      b.className = "badge " + type;
      b.textContent = type === "ok" ? "correct!" : "wrong!";
      statusEl.appendChild(b);
    }

    const c = document.createElement("span");
    c.className = "small";
    c.textContent = sub || "";
    statusEl.appendChild(c);
  }

  function pulsePop(el){
    el.classList.remove("pop");
    void el.offsetWidth;
    el.classList.add("pop");
  }
  function pulseShake(el){
    el.classList.remove("shake");
    void el.offsetWidth;
    el.classList.add("shake");
  }

  // ‚úÖ ËÄÅÂ∏´‰øùÈö™Ê†∏ÂøÉÔºö‰æù„ÄåÂÆπÂô®ÂØ¨Â∫¶ + ÂñÆÂ≠óÈï∑Â∫¶„ÄçËá™ÂãïÁ∏ÆÂ∞èÊ†ºÂ≠êÔºå‰∏çÂáÜÊèõË°å
  function applyTeacherFit(word){
    const n = word.length;
    const wrap = slotsEl.parentElement; // slotsWrap
    const wrapWidth = wrap.getBoundingClientRect().width;

    const defaultSize = 64;
    const defaultGap  = 10;

    const minSize = 44;
    const minGap  = 6;

    const safe = 40;
    const available = Math.max(240, wrapWidth - safe);

    let gap = defaultGap;
    let size = Math.floor((available - gap * (n - 1)) / n);

    if(size > defaultSize) size = defaultSize;

    if(size < minSize){
      gap = minGap;
      size = Math.floor((available - gap * (n - 1)) / n);
    }

    if(size < minSize) size = minSize;

    let font = Math.round(size * 0.53);
    if(font < 22) font = 22;
    if(font > 34) font = 34;

    document.documentElement.style.setProperty("--slotSize", size + "px");
    document.documentElement.style.setProperty("--slotGap", gap + "px");
    document.documentElement.style.setProperty("--slotFont", font + "px");
  }

  function buildSlots(target){
    slotsEl.innerHTML = "";
    for(let i=0;i<target.length;i++){
      const s = document.createElement("div");
      s.className = "slot";
      s.dataset.pos = String(i);
      s.dataset.letter = "";
      s.addEventListener("dragover", (e)=> e.preventDefault());
      s.addEventListener("drop", onDropToSlot);
      slotsEl.appendChild(s);
    }
  }

  function buildTiles(target){
    tilesEl.innerHTML = "";
    const letters = shuffle(target.split(""));
    letters.forEach((ch, k)=>{
      const t = document.createElement("div");
      t.className = "tile";
      t.draggable = true;
      t.innerText = ch.toLowerCase();
      t.id = `tile_${idx}_${k}_${ch}_${Math.random()}`;
      t.addEventListener("dragstart", (e)=>{
        e.dataTransfer.setData("text/plain", t.id);

        // ‚úÖ Êñ∞ÂäüËÉΩÔºöÊãñÊõ≥ÊôÇÂî∏Â≠óÊØç
        speakLetter(t.innerText);
      });
      tilesEl.appendChild(t);
    });
  }

  function loadRound(){
    const item = order[idx];
    const target = item.word;

    applyTeacherFit(target);

    pic.src = item.img;
    pic.alt = target;

    buildSlots(target);
    buildTiles(target);

    setStatus("spell it!", "Ôºàdrag the lettersÔºâ");
    speak(target);
  }

  function getCurrentSpelling(){
    const letters = [];
    [...slotsEl.querySelectorAll(".slot")].forEach(s=>{
      letters.push(s.dataset.letter || "");
    });
    return letters.join("");
  }

  function autoCheckIfComplete(){
    const item = order[idx];
    const target = item.word;
    const got = getCurrentSpelling();

    if(got.length !== target.length || got.includes("")) return;

    if(got === target){
      score++;
      scoreEl.textContent = String(score);
      setStatus("great!", "Ôºànext word!Ôºâ", "ok");
      speak(target);

      setTimeout(()=>{
        idx++;
        if(idx >= order.length){
          finishGame();
        }else{
          loadRound();
        }
      }, 520);
    }
  }

  function onDropToSlot(e){
    e.preventDefault();
    const tileId = e.dataTransfer.getData("text/plain");
    const tile = document.getElementById(tileId);
    if(!tile) return;

    const item = order[idx];
    const target = item.word;
    const pos = Number(this.dataset.pos);
    const expected = target[pos].toLowerCase();
    const ch = tile.innerText.toLowerCase();

    // Ëã•Ê†ºÂ≠êÂéüÊú¨ÊúâÂ≠óÊØçÔºåÂÖàÈÄÄÂõû tiles
    if(this.dataset.letter && this.dataset.letter !== ""){
      const oldCh = this.dataset.letter;
      const back = document.createElement("div");
      back.className = "tile";
      back.draggable = true;
      back.innerText = oldCh;
      back.id = `tile_return_${Date.now()}_${Math.random()}`;
      back.addEventListener("dragstart", (ev)=>{
        ev.dataTransfer.setData("text/plain", back.id);
        speakLetter(back.innerText);
      });
      tilesEl.appendChild(back);

      this.dataset.letter = "";
      this.innerText = "";
      this.classList.remove("filled");
    }

    // ‚úÖ ÊîæÈåØÔºöÁ´ãÂàªÈÄÄÂõû + ÊäñÂãï
    if(ch !== expected){
      pulseShake(slotsEl);
      setStatus("oops!", "Ôºàwrong letter, try againÔºâ", "bad");

      // ‰∏çÁßªÈô§ tileÔºàÁ´ãÂàªÈÄÄÂõûÁöÑÊïàÊûúÔºâ
      tile.style.opacity = "0.35";
      tile.style.transform = "scale(0.95)";
      setTimeout(()=>{
        tile.style.opacity = "1";
        tile.style.transform = "scale(1)";
      }, 160);

      return;
    }

    // ‚úÖ ÊîæÂ∞çÔºöÊâçÊîæÂÖ•Ê†ºÂ≠ê + pop + ÂÜçÂî∏‰∏ÄÊ¨°Â≠óÊØç
    this.innerText = ch;
    this.dataset.letter = ch;
    this.classList.add("filled");
    tile.remove();

    pulsePop(this);      // ÊîæÂ∞çÊ†ºÂ≠êÊîæÂ§ß‰∏Ä‰∏ã
    speakLetter(ch);     // ‚úÖ Êñ∞ÂäüËÉΩÔºöÊîæÂ∞çÂÜçÂî∏‰∏ÄÊ¨°Â≠óÊØç
    setStatus("good!", "Ôºàkeep goingÔºâ", "ok");

    autoCheckIfComplete();
  }

  function clearSlots(){
    const slots = [...slotsEl.querySelectorAll(".slot")];
    slots.forEach(s=>{
      if(s.dataset.letter && s.dataset.letter !== ""){
        const ch = s.dataset.letter;
        const t = document.createElement("div");
        t.className = "tile";
        t.draggable = true;
        t.innerText = ch;
        t.id = `tile_return_${Date.now()}_${Math.random()}`;
        t.addEventListener("dragstart", (ev)=>{
          ev.dataTransfer.setData("text/plain", t.id);
          speakLetter(t.innerText);
        });
        tilesEl.appendChild(t);

        s.dataset.letter = "";
        s.innerText = "";
        s.classList.remove("filled");
      }
    });
    setStatus("cleared!", "Ôºàtry againÔºâ");
  }

  // finish overlay + confetti
  let fxTimer = null;
  const canvas = $("fx");
  const ctx = canvas.getContext("2d");
  let confetti = [];

  function showOverlay(){ overlay.classList.add("show"); }
  function hideOverlay(){ overlay.classList.remove("show"); }

  function resizeCanvas(){
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * devicePixelRatio);
    canvas.height = Math.floor(rect.height * devicePixelRatio);
    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
  }

  function randomColor(){
    const colors = ["#ff6b6b","#ffd166","#06d6a0","#4d96ff","#a78bfa","#ff8fab","#8bd3dd"];
    return colors[Math.floor(Math.random()*colors.length)];
  }

  function spawnConfetti(){
    const rect = canvas.getBoundingClientRect();
    for(let i=0;i<24;i++){
      confetti.push({
        x: Math.random()*rect.width,
        y: -20 - Math.random()*80,
        vx: (Math.random()-0.5)*2.2,
        vy: 2.5 + Math.random()*2.8,
        r: 4 + Math.random()*6,
        rot: Math.random()*Math.PI,
        vr: (Math.random()-0.5)*0.2,
        color: randomColor(),
        life: 0,
        max: 220 + Math.random()*140
      });
    }
  }

  function tickConfetti(){
    const rect = canvas.getBoundingClientRect();
    ctx.clearRect(0,0,rect.width,rect.height);

    spawnConfetti();

    confetti = confetti.filter(p => p.life < p.max);
    for(const p of confetti){
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.life += 1;

      if(p.x < -20) p.x = rect.width+20;
      if(p.x > rect.width+20) p.x = -20;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
      ctx.restore();
    }
  }

  function startConfetti(){
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);
    confetti = [];
    if(fxTimer) clearInterval(fxTimer);
    fxTimer = setInterval(tickConfetti, 50);
  }

  function stopConfetti(){
    if(fxTimer){
      clearInterval(fxTimer);
      fxTimer = null;
    }
    confetti = [];
    ctx.clearRect(0,0,canvas.width,canvas.height);
    window.removeEventListener("resize", resizeCanvas);
  }

  function finishGame(){
    stopTimer();
    const t = Number(timeEl.textContent);
    finalText.textContent = `you finished in ${t.toFixed(1)} seconds! ‚ú®`;
    showOverlay();
    speak("great job");
    startConfetti();
    setTimeout(stopConfetti, 4200);
  }

  function restart(){
    hideOverlay();
    stopConfetti();

    order = shuffle(items.slice());
    idx = 0;
    score = 0;
    scoreEl.textContent = "0";
    timeEl.textContent = "0.0";

    stopTimer();
    startTimer();
    loadRound();
  }

  $("restartBtn").addEventListener("click", restart);
  $("bigReplay").addEventListener("click", restart);
  $("clearBtn").addEventListener("click", clearSlots);
  $("speakBtn").addEventListener("click", ()=>{
    if(order.length === 0) return;
    speak(order[idx].word);
  });

  window.addEventListener("resize", ()=>{
    if(order.length === 0) return;
    applyTeacherFit(order[idx].word);
  });

  restart();
</script>
</body>
</html>
