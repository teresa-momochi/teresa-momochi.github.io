<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç¬¬ä¹å–®å…ƒâ€”æ‹¼å­—éŠæˆ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Microsoft JhengHei", system-ui, -apple-system, sans-serif;
      background: #f5f7fb;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-top: 32px;
      font-size: 32px;
    }
    .subtitle {
      text-align: center;
      margin-bottom: 24px;
      color: #666;
      font-size: 15px;
    }
    .game-container {
      max-width: 1100px;
      margin: 0 auto 40px;
      padding: 0 16px 40px;
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      justify-content: center;
    }
    .card {
      background: #fff;
      border-radius: 24px;
      padding: 24px 24px 28px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
      width: 320px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card.completed {
      box-shadow: 0 0 0 3px #4caf50 inset;
    }
    .card img {
      width: 200px;
      height: 200px;
      object-fit: contain;
      margin-bottom: 16px;
      cursor: pointer;
    }
    .hint {
      margin-bottom: 12px;
      font-size: 16px;
      color: #444;
    }
    .answer-row {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      min-height: 48px;
    }
    .answer-slot {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: 2px dashed #cfd3e3;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: bold;
    }
    .answer-row.correct .answer-slot {
      border-color: #4caf50;
      background: #e8f5e9;
      color: #2e7d32;
    }
    .letters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }
    .letter-btn {
      min-width: 40px;
      height: 40px;
      border-radius: 10px;
      border: none;
      background: #eef1ff;
      color: #333;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.1s, background 0.1s;
    }
    .letter-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.15) inset;
    }
    .letter-btn.used {
      opacity: 0.2;
      pointer-events: none;
    }
    .message {
      text-align: center;
      margin-top: 8px;
      min-height: 24px;
      font-size: 14px;
    }
    .message.ok {
      color: #2e7d32;
    }
    .message.error {
      color: #d32f2f;
    }
    .controls {
      text-align: center;
      margin-bottom: 16px;
    }
    .reset-btn {
      padding: 6px 14px;
      border-radius: 999px;
      border: none;
      background: #ffb74d;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      margin-left: 6px;
    }
    @media (max-width: 960px) {
      .card {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>ç¬¬ä¹å–®å…ƒâ€”æ‹¼å­—éŠæˆ²</h1>
  <div class="subtitle">é»åœ–è½ç™¼éŸ³ï¼Œé»ä¸‹é¢çš„å­—æ¯æ‹¼å‡ºå–®å­—ã€‚ä¸‰å€‹å–®å­—å®Œæˆå¾Œæœƒè‡ªå‹•å†æ´—ç‰Œï¼Œè®“ä½ ä¸€ç›´ç©ä¸‹å»ï¼</div>

  <div class="controls">
    <button class="reset-btn" id="resetAllBtn">é‡æ–°æ´—ç‰Œå†ç©ä¸€æ¬¡</button>
  </div>

  <div class="game-container" id="gameContainer">
    <!-- å¡ç‰‡æœƒç”± JavaScript è‡ªå‹•ç”¢ç”Ÿ -->
  </div>

  <script>
    // ğŸ¯ ç¬¬ä¹èª²ä¸‰å€‹å–®å­—ï¼ˆåœ–ç‰‡æª”åè«‹ç¢ºå®šæ”¾åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ï¼‰
    const WORDS = [
      {
        id: 1,
        word: "SHARE",
        zhHint: "åˆ†äº«",
        image: "share.png"
      },
      {
        id: 2,
        word: "STUDY",
        zhHint: "è®€æ›¸",
        image: "study.png"
      },
      {
        id: 3,
        word: "PLAY",
        zhHint: "ç©è€",
        image: "play.png"
      }
    ];

    const gameContainer = document.getElementById("gameContainer");

    // å°å·¥å…·ï¼šæ‰“äº‚é™£åˆ—
    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // ç”¨ç€è¦½å™¨å…§å»ºèªéŸ³å¿µå‡ºå–®å­—ï¼ˆä¸ç”¨ mp3ï¼‰
    function speakWord(text) {
      if (!("speechSynthesis" in window)) {
        return; // å¾ˆèˆŠçš„ç€è¦½å™¨å°±ä¸å¿µ
      }

      const utter = new SpeechSynthesisUtterance(text.toLowerCase());
      utter.lang = "en-US";
      utter.rate = 0.9;  // èªé€Ÿç¨æ…¢ï¼Œçµ¦å°æœ‹å‹è½
      utter.pitch = 1.0;

      const voices = window.speechSynthesis.getVoices();
      // å„ªå…ˆæ‰¾è‹±æ–‡å¥³è²ï¼ˆå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±ç”¨ç³»çµ±é è¨­ï¼‰
      const female = voices.find(v =>
        v.lang.startsWith("en") &&
        /female|woman|å¥³/i.test(v.name)
      );
      if (female) {
        utter.voice = female;
      }

      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    // ç”Ÿæˆæ•´å€‹éŠæˆ²ç•«é¢
    function renderGame() {
      gameContainer.innerHTML = "";

      WORDS.forEach((item) => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.id = item.id;

        // åœ–ç‰‡ï¼ˆé»åœ–æœƒå”¸ï¼‰
        const img = document.createElement("img");
        img.src = item.image;
        img.alt = item.word;
        img.addEventListener("click", () => speakWord(item.word));
        card.appendChild(img);

        // ä¸­æ–‡æç¤º
        const hint = document.createElement("div");
        hint.className = "hint";
        hint.textContent = `${item.zhHint}ï¼ˆé»åœ–å¯è½ç™¼éŸ³ï¼‰`;
        card.appendChild(hint);

        // ç­”æ¡ˆæ ¼
        const answerRow = document.createElement("div");
        answerRow.className = "answer-row";
        answerRow.dataset.answerFor = item.id;

        for (let i = 0; i < item.word.length; i++) {
          const slot = document.createElement("div");
          slot.className = "answer-slot";
          slot.dataset.slotIndex = i;
          answerRow.appendChild(slot);
        }
        card.appendChild(answerRow);

        // å­—æ¯å€
        const lettersRow = document.createElement("div");
        lettersRow.className = "letters-row";
        lettersRow.dataset.lettersFor = item.id;

        const scrambledLetters = shuffle(item.word.split(""));
        scrambledLetters.forEach((ch) => {
          const btn = document.createElement("button");
          btn.className = "letter-btn";
          btn.textContent = ch;
          btn.dataset.letter = ch;
          btn.dataset.used = "false";
          btn.addEventListener("click", () =>
            handleLetterClick(item, card, btn)
          );
          lettersRow.appendChild(btn);
        });
        card.appendChild(lettersRow);

        // è¨Šæ¯åˆ—
        const msg = document.createElement("div");
        msg.className = "message";
        msg.dataset.messageFor = item.id;
        card.appendChild(msg);

        gameContainer.appendChild(card);
      });
    }

    // é»å­—æ¯ï¼šå¡«å…¥ä¸‹ä¸€å€‹ç©ºæ ¼
    function handleLetterClick(item, cardElem, btnElem) {
      if (btnElem.dataset.used === "true") return;
      if (cardElem.classList.contains("completed")) return;

      const answerRow = cardElem.querySelector(".answer-row");
      const slots = Array.from(answerRow.querySelectorAll(".answer-slot"));

      // æ‰¾ä¸‹ä¸€å€‹ç©º slot
      const nextSlot = slots.find(slot => !slot.textContent);
      if (!nextSlot) return;

      nextSlot.textContent = btnElem.dataset.letter;
      btnElem.classList.add("used");
      btnElem.dataset.used = "true";

      const currentAnswer = slots.map(s => s.textContent || "").join("");

      if (currentAnswer.length === item.word.length) {
        if (currentAnswer === item.word) {
          handleCorrect(item, cardElem);
        } else {
          handleWrong(item, cardElem);
        }
      }
    }

    // ç­”å°
    function handleCorrect(item, cardElem) {
      const answerRow = cardElem.querySelector(".answer-row");
      const msg = cardElem.querySelector(".message");
      answerRow.classList.add("correct");
      msg.textContent = "å¤ªæ£’äº†ï¼ç­”å°å›‰ï¼";
      msg.className = "message ok";
      cardElem.classList.add("completed");

      // ç­”å°æ™‚ä¹Ÿå¹«å¿™å”¸ä¸€æ¬¡å–®å­—
      speakWord(item.word);

      // æª¢æŸ¥æ˜¯ä¸æ˜¯ä¸‰å€‹éƒ½å®Œæˆ
      setTimeout(() => {
        if (checkAllCompleted()) {
          setTimeout(() => {
            alert("ä¸‰å€‹éƒ½æ‹¼å°äº†ï¼å†æ´—ç‰Œç©ä¸€æ¬¡å§ï¼");
            startNewRound();
          }, 400);
        }
      }, 400);
    }

    // ç­”éŒ¯ï¼šæ¸…ç©ºç­”æ¡ˆ & é‚„åŸå­—æ¯
    function handleWrong(item, cardElem) {
      const answerRow = cardElem.querySelector(".answer-row");
      const slots = answerRow.querySelectorAll(".answer-slot");
      const letters = cardElem.querySelectorAll(".letter-btn");
      const msg = cardElem.querySelector(".message");

      msg.textContent = "å†æƒ³æƒ³çœ‹ï½ä¸å¤ªå°å–”ï¼";
      msg.className = "message error";

      setTimeout(() => {
        slots.forEach(slot => (slot.textContent = ""));
        letters.forEach(btn => {
          btn.classList.remove("used");
          btn.dataset.used = "false";
        });
        msg.textContent = "";
      }, 700);
    }

    // æœ‰æ²’æœ‰ä¸‰å€‹éƒ½å®Œæˆï¼Ÿ
    function checkAllCompleted() {
      const cards = Array.from(document.querySelectorAll(".card"));
      return cards.every(card => card.classList.contains("completed"));
    }

    // é‡æ–°é–‹å§‹ä¸€è¼ªï¼šæ¸…ç©º + é‡æ–°æ´—ç‰Œ
    function startNewRound() {
      const cards = Array.from(document.querySelectorAll(".card"));

      cards.forEach(card => {
        card.classList.remove("completed");
        const answerRow = card.querySelector(".answer-row");
        const slots = answerRow.querySelectorAll(".answer-slot");
        const msg = card.querySelector(".message");
        const lettersRow = card.querySelector(".letters-row");
        const wordId = Number(card.dataset.id);
        const wordObj = WORDS.find(w => w.id === wordId);

        // æ¸…ç©ºç­”æ¡ˆ
        answerRow.classList.remove("correct");
        slots.forEach(slot => (slot.textContent = ""));
        msg.textContent = "";
        msg.className = "message";

        // é‡æ–°æ´—ç‰Œå­—æ¯
        const scrambledLetters = shuffle(wordObj.word.split(""));
        lettersRow.innerHTML = "";
        scrambledLetters.forEach(ch => {
          const btn = document.createElement("button");
          btn.className = "letter-btn";
          btn.textContent = ch;
          btn.dataset.letter = ch;
          btn.dataset.used = "false";
          btn.addEventListener("click", () =>
            handleLetterClick(wordObj, card, btn)
          );
          lettersRow.appendChild(btn);
        });
      });
    }

    // ã€Œé‡æ–°æ´—ç‰Œã€æŒ‰éˆ•
    document.getElementById("resetAllBtn").addEventListener("click", () => {
      startNewRound();
    });

    // æœ‰äº›ç€è¦½å™¨èªéŸ³æ¸…å–®æœƒæ™šä¸€é»æ‰è¼‰å…¥ï¼Œç¢°ä¸€ä¸‹è®“å®ƒè¼‰å…¥
    if ("speechSynthesis" in window) {
      window.speechSynthesis.onvoiceschanged = () => {};
    }

    // åˆå§‹åŒ–
    renderGame();
  </script>
</body>
</html>
